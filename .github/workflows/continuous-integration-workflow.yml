name: Build and Test

on:
  push:
    branches:
      - beta

jobs:
  ci:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        version:
          # This must match whatâ€™s in versions.sh
          - '3.0-beta.0'

    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Build
      run: ./build.sh
      env:
        CI_VERSION: ${{ matrix.version }}

    - name: Test
      run: ./test.sh
      env:
        CI_VERSION: ${{ matrix.version }}
        SKIP_CLEANUP: 1

    - name: Login to Dockerhub
      run: docker login --username jorgenvatle --password '${{ secrets.DOCKER_PASSWORD }}'

    - name: Push to Dockerhub
      run: ./push.sh

